<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>JavaScript.WebSockets.Internal</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_JavaScript-WebSockets-Internal.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">ghcjs-websockets-0.2.0.0: GHCJS interface for the Javascript Websocket API</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Copyright</th><td>(c) Justin Le 2015</td></tr><tr><th>License</th><td>MIT</td></tr><tr><th>Maintainer</th><td>justin@jle.im</td></tr><tr><th>Stability</th><td>unstable</td></tr><tr><th>Portability</th><td>ghcjs</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">JavaScript.WebSockets.Internal</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Types</a><ul><li><a href="#g:2">Data types</a></li><li><a href="#g:3">Typeclasses</a></li><li><a href="#g:4">Exceptions</a></li></ul></li><li><a href="#g:5">Manipulating and inspecting <code>Connection</code>s</a></li><li><a href="#g:6">Sending and receiving</a></li><li><a href="#g:7">Connection mutex</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Low-level API for the <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> socket wrapper, for situations like
 debugging when things exported by <a href="JavaScript-WebSockets.html">JavaScript.WebSockets</a> is not enough.
 Most everyday usage should be covered by the aforementioned module, so
 don't import this unless you really really have to.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span> <a href="#t:Connection">Connection</a> = <a href="#v:Connection">Connection</a> {<ul class="subs"><li><a href="#v:_connSocket">_connSocket</a> :: Socket</li><li><a href="#v:_connQueue">_connQueue</a> :: ConnectionQueue</li><li><a href="#v:_connWaiters">_connWaiters</a> :: ConnectionWaiters</li><li><a href="#v:_connOrigin">_connOrigin</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></li><li><a href="#v:_connClosed">_connClosed</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-IORef.html#t:IORef">IORef</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnClosing">ConnClosing</a>)</li><li><a href="#v:_connBlock">_connBlock</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Control-Concurrent-MVar.html#t:MVar">MVar</a> ()</li></ul>}</li><li class="src short"><span class="keyword">data</span> <a href="#t:SocketMsg">SocketMsg</a><ul class="subs"><li>= <a href="#v:SocketMsgText">SocketMsgText</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></li><li>| <a href="#v:SocketMsgData">SocketMsgData</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/bytestring-0.10.6.0/html/Data-ByteString-Lazy.html#t:ByteString">ByteString</a></li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:ConnClosing">ConnClosing</a><ul class="subs"><li>= <a href="#v:ManualClose">ManualClose</a></li><li>| <a href="#v:JSClose">JSClose</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a>) (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Int.html#t:Int">Int</a>) (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a>)</li><li>| <a href="#v:OpenInterruptedClose">OpenInterruptedClose</a></li><li>| <a href="#v:UnexpectedClose">UnexpectedClose</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></li></ul></li><li class="src short"><span class="keyword">class</span> <a href="#t:WSSendable">WSSendable</a> s <span class="keyword">where</span><ul class="subs"><li><a href="#v:wrapSendable">wrapSendable</a> :: s -&gt; <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></li></ul></li><li class="src short"><span class="keyword">class</span> <a href="#t:WSReceivable">WSReceivable</a> s <span class="keyword">where</span><ul class="subs"><li><a href="#v:unwrapReceivable">unwrapReceivable</a> :: <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Either.html#t:Either">Either</a> <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a> s</li></ul></li><li class="src short"><span class="keyword">data</span> <a href="#t:ConnectionException">ConnectionException</a> = <a href="#v:ConnectionClosed">ConnectionClosed</a> {<ul class="subs"><li><a href="#v:_socketOrigin">_socketOrigin</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></li></ul>}</li><li class="src short"><a href="#v:openConnectionImmediate">openConnectionImmediate</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Control-Concurrent-MVar.html#t:MVar">MVar</a> <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a>)</li><li class="src short"><a href="#v:closeConnection">closeConnection</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:closeConnectionLeftovers">closeConnectionLeftovers</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> [<a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a>]</li><li class="src short"><a href="#v:clearConnectionQueue">clearConnectionQueue</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:dumpConnectionQueue">dumpConnectionQueue</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> [<a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a>]</li><li class="src short"><a href="#v:connectionClosed">connectionClosed</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:connectionCloseReason">connectionCloseReason</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnClosing">ConnClosing</a>)</li><li class="src short"><a href="#v:connectionStateCode">connectionStateCode</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Int.html#t:Int">Int</a></li><li class="src short"><a href="#v:sendMessage">sendMessage</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a></li><li class="src short"><a href="#v:receiveMessageMaybe">receiveMessageMaybe</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a>)</li><li class="src short"><a href="#v:withConnBlock">withConnBlock</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a</li><li class="src short"><a href="#v:withConnBlockMasked">withConnBlockMasked</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a</li></ul></div><div id="interface"><h1 id="g:1">Types</h1><h2 id="g:2">Data types</h2><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:Connection" class="def">Connection</a></p><div class="doc"><p>Encapsulates a (reference to a) Javascript Websocket connection.  Can
 be created/accessed with either <code>openConnection</code> or (preferably)
 <code>withUrl</code>.</p><p>Care must be taken to close the connection once you are done if using
 <code>openConnection</code>, or unprocessed messages and callbacks will continue to
 queue up.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Connection" class="def">Connection</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:_connSocket" class="def">_connSocket</a> :: Socket</dt><dd class="doc"><p>JSRef to JS Websocket object</p></dd><dt class="src"><a name="v:_connQueue" class="def">_connQueue</a> :: ConnectionQueue</dt><dd class="doc"><p>JSRef to JSArray of queued incoming
 messages, managed directly in FFI</p></dd><dt class="src"><a name="v:_connWaiters" class="def">_connWaiters</a> :: ConnectionWaiters</dt><dd class="doc"><p>JSRef to JSArray of queue of waiting
 receivers, managed directly in FFI</p></dd><dt class="src"><a name="v:_connOrigin" class="def">_connOrigin</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></dt><dd class="doc"><p>Text of server socket was originally
 opened with</p></dd><dt class="src"><a name="v:_connClosed" class="def">_connClosed</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-IORef.html#t:IORef">IORef</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnClosing">ConnClosing</a>)</dt><dd class="doc"><p>IORef with Nothing if the connection is
 still open and <code>Just reason</code> if it's
 closed, with the reason</p></dd><dt class="src"><a name="v:_connBlock" class="def">_connBlock</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Control-Concurrent-MVar.html#t:MVar">MVar</a> ()</dt><dd class="doc"><p>Mutex for thread-safe manipulation</p></dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:SocketMsg" class="def">SocketMsg</a></p><div class="doc"><p>Sum type over the data that can be sent or received through
 a JavaScript websocket.</p><p>What an incoming message is classified as depends on the Javascript
 Websockets API <a href="http://www.w3.org/TR/websockets/">http://www.w3.org/TR/websockets/</a>, which provides
 a &quot;typed&quot; input channel of either text or binary blob.</p><p>There are several convenience functions to help you never have to deal
 with this explicitly; its main purpose is if you want to explicitly
 branch on a <code>receiveMessage</code> depending on what kind of message you
 receive and do separate things. <code>receiveText</code> and <code>receiveData</code> will
 both allow you to &quot;filter&quot; incoming messages by their type.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:SocketMsgText" class="def">SocketMsgText</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:SocketMsgData" class="def">SocketMsgData</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/bytestring-0.10.6.0/html/Data-ByteString-Lazy.html#t:ByteString">ByteString</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:SocketMsg" class="caption collapser" onclick="toggleSection('i:SocketMsg')">Instances</p><div id="section.i:SocketMsg" class="show"><table><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Eq.html#t:Eq">Eq</a> <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Text-Show.html#t:Show">Show</a> <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Typeable-Internal.html#t:Typeable">Typeable</a> * <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ConnClosing" class="def">ConnClosing</a></p><div class="doc"><p>Data type containing information on <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> closes.</p><ul><li><code><a href="JavaScript-WebSockets-Internal.html#v:ManualClose">ManualClose</a></code>: Closed by the Haskell <code><a href="JavaScript.html#t:WebSockets">WebSockets</a></code>
    interface, using <code><a href="JavaScript-WebSockets-Internal.html#v:closeConnection">closeConnection</a></code> or variants.</li><li><p><code><a href="JavaScript-WebSockets-Internal.html#v:JSClose">JSClose</a></code>: Closed on the Javascript end, either by a connection error
    or server request, or what have you.  Contains information from the
    Javascript Websockets API
    <a href="http://www.w3.org/TR/websockets/#event-definitions">http://www.w3.org/TR/websockets/#event-definitions</a>.</p><p>The first field is whether or not it was a clean close; the second
field is the closing reason code; the third field is a <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></code> with
the reason given by the Websockets API.</p></li><li><code>OpenInterupptedClose</code>: There was an unexpected error encountered
    when attempting to open the connection.</li><li><code><a href="JavaScript-WebSockets-Internal.html#v:UnexpectedClose">UnexpectedClose</a></code>: Otherwise uncategorized closed status, with
    a <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></code> field offering a reason.</li></ul></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ManualClose" class="def">ManualClose</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:JSClose" class="def">JSClose</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a>) (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Int.html#t:Int">Int</a>) (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a>)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:OpenInterruptedClose" class="def">OpenInterruptedClose</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:UnexpectedClose" class="def">UnexpectedClose</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:ConnClosing" class="caption collapser" onclick="toggleSection('i:ConnClosing')">Instances</p><div id="section.i:ConnClosing" class="show"><table><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Eq.html#t:Eq">Eq</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnClosing">ConnClosing</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Text-Show.html#t:Show">Show</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnClosing">ConnClosing</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h2 id="g:3">Typeclasses</h2><div class="top"><p class="src"><span class="keyword">class</span> <a name="t:WSSendable" class="def">WSSendable</a> s <span class="keyword">where</span></p><div class="doc"><p>A typeclass offering a gratuitous abstraction over what can be sent
 through a <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>.  Allows you to wrap things in a <code><a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></code>
 automatically.  The only instances that should really ever exist are
 <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></code> and instances of <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/binary-0.7.2.3/html/Data-Binary.html#t:Binary">Binary</a></code>.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:wrapSendable" class="def">wrapSendable</a> :: s -&gt; <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></p></div><div class="subs instances"><p id="control.i:WSSendable" class="caption collapser" onclick="toggleSection('i:WSSendable')">Instances</p><div id="section.i:WSSendable" class="show"><table><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/binary-0.7.2.3/html/Data-Binary.html#t:Binary">Binary</a> a =&gt; <a href="JavaScript-WebSockets-Internal.html#t:WSSendable">WSSendable</a> a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="JavaScript-WebSockets-Internal.html#t:WSSendable">WSSendable</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">class</span> <a name="t:WSReceivable" class="def">WSReceivable</a> s <span class="keyword">where</span></p><div class="doc"><p>A typeclass offering a gratuitous abstraction over what can be
 received through a <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>.  Allows you to unwrap things in
 a <code><a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></code> automatically.  The only instances that should really ever
 exist are <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></code> and instances of <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/binary-0.7.2.3/html/Data-Binary.html#t:Binary">Binary</a></code>.</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:unwrapReceivable" class="def">unwrapReceivable</a> :: <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Either.html#t:Either">Either</a> <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a> s</p></div><div class="subs instances"><p id="control.i:WSReceivable" class="caption collapser" onclick="toggleSection('i:WSReceivable')">Instances</p><div id="section.i:WSReceivable" class="show"><table><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/binary-0.7.2.3/html/Data-Binary.html#t:Binary">Binary</a> a =&gt; <a href="JavaScript-WebSockets-Internal.html#t:WSReceivable">WSReceivable</a> a</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="JavaScript-WebSockets-Internal.html#t:WSReceivable">WSReceivable</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h2 id="g:4">Exceptions</h2><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:ConnectionException" class="def">ConnectionException</a></p><div class="doc"><p>An exception that may be thrown when using the various <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>
 operations.  Right now, only includes <code><a href="JavaScript-WebSockets-Internal.html#v:ConnectionClosed">ConnectionClosed</a></code>, which is
 thrown when using an &quot;unsafe&quot; <code>receive</code> on a closed <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>, or if
 a <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> closes while an unsafe <code>receive</code> is waiting.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:ConnectionClosed" class="def">ConnectionClosed</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:_socketOrigin" class="def">_socketOrigin</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div><div class="subs instances"><p id="control.i:ConnectionException" class="caption collapser" onclick="toggleSection('i:ConnectionException')">Instances</p><div id="section.i:ConnectionException" class="show"><table><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Eq.html#t:Eq">Eq</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnectionException">ConnectionException</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Text-Show.html#t:Show">Show</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnectionException">ConnectionException</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Control-Exception-Base.html#t:Exception">Exception</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnectionException">ConnectionException</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Typeable-Internal.html#t:Typeable">Typeable</a> * <a href="JavaScript-WebSockets-Internal.html#t:ConnectionException">ConnectionException</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><h1 id="g:5">Manipulating and inspecting <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>s</h1><div class="top"><p class="src"><a name="v:openConnectionImmediate" class="def">openConnectionImmediate</a> :: <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Control-Concurrent-MVar.html#t:MVar">MVar</a> <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a>)</p><div class="doc"><p>A version of <code>openConnection</code> that doesn't wait for the connection to
 be opened.  Returns an <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Control-Concurrent-MVar.html#t:MVar">MVar</a></code> where the connection can be expected to be
 placed when it is opened.</p></div></div><div class="top"><p class="src"><a name="v:closeConnection" class="def">closeConnection</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Manually closes the given <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>.  Will un-block all threads
 currently waiting on the <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> for messages (releasing their
 callbacks) and disable sending and receiving in the future.</p><p>All leftover messages that were never processed on the Haskell end will
 be deleted; use <code><a href="JavaScript-WebSockets-Internal.html#v:dumpConnectionQueue">dumpConnectionQueue</a></code> to manually fetch them before
 closing, or <code><a href="JavaScript-WebSockets-Internal.html#v:closeConnectionLeftovers">closeConnectionLeftovers</a></code> to recover them while closing.</p></div></div><div class="top"><p class="src"><a name="v:closeConnectionLeftovers" class="def">closeConnectionLeftovers</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> [<a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a>]</p><div class="doc"><p>Manually closes the given <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>.  It un-blocks all threads
 currently waiting on the connection and disables all sending and
 receiving in the future.</p><p>The result is a list of all messages received by the connection but not
 yet retrieved by <code>receive</code>, etc. on the Haskell end.</p><p>To close and ignore leftovers, use <code><a href="JavaScript-WebSockets-Internal.html#v:closeConnection">closeConnection</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:clearConnectionQueue" class="def">clearConnectionQueue</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> ()</p><div class="doc"><p>Clears the message queue (messages waiting to be <code>receive</code>d) on the
 given <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>.  Is essentially a no-op on closed connections.</p></div></div><div class="top"><p class="src"><a name="v:dumpConnectionQueue" class="def">dumpConnectionQueue</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> [<a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a>]</p><div class="doc"><p>Returns all incoming messages received by the socket and queued for
 retrieval using <code>receive</code> functions.  Empties the queue.</p></div></div><div class="top"><p class="src"><a name="v:connectionClosed" class="def">connectionClosed</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a></p><div class="doc"><p>Check if the given <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> is closed.  Returns a <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a></code>.  To
 check *why* it was closed, see <code><a href="JavaScript-WebSockets-Internal.html#v:connectionCloseReason">connectionCloseReason</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:connectionCloseReason" class="def">connectionCloseReason</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="JavaScript-WebSockets-Internal.html#t:ConnClosing">ConnClosing</a>)</p><div class="doc"><p>Returns <code>Nothing</code> if the given <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> is still open, or <code>Just
 closing</code> containing a <code><a href="JavaScript-WebSockets-Internal.html#t:ConnClosing">ConnClosing</a></code> with information on why the
 connection was closed.</p><p>For just a <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a></code> saying whether or not the connection is closed, try
 <code><a href="JavaScript-WebSockets-Internal.html#v:connectionClosed">connectionClosed</a></code>.</p></div></div><div class="top"><p class="src"><a name="v:connectionStateCode" class="def">connectionStateCode</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Int.html#t:Int">Int</a></p><div class="doc"><p>Returns the &quot;readyState&quot; of the connection's javascript websockets
 API: 0 is connecting, 1 is open, 2 is closing, and 3 is closed.
 Shouldn't really be used except for debugging purposes.  Use
 <code><a href="JavaScript-WebSockets-Internal.html#v:connectionCloseReason">connectionCloseReason</a></code> whenever possible to get information in a nice
 haskelley sum type.</p></div></div><h1 id="g:6">Sending and receiving</h1><div class="top"><p class="src"><a name="v:sendMessage" class="def">sendMessage</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#t:Bool">Bool</a></p><div class="doc"><p>Sends the given <code><a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></code> through the given <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code>.
 A <code><a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></code> is a sum type of either 'SocketMsgText t', containing
 (strict) <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></code>, or 'SocketMsgData d', containing a (lazy) <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/bytestring-0.10.6.0/html/Data-ByteString-Lazy.html#t:ByteString">ByteString</a></code>.</p><p>Returns <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#v:True">True</a></code> if the connection is open, and <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Bool.html#v:False">False</a></code> if it is closed.
 In the future will return more feedback about whether or not the send
 was completed succesfully.</p></div></div><div class="top"><p class="src"><a name="v:receiveMessageMaybe" class="def">receiveMessageMaybe</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> (<a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#t:Maybe">Maybe</a> <a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a>)</p><div class="doc"><p>Block and wait until the <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> receives any message, and
 returns the message wrapped in a <code><a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></code>.  A <code><a href="JavaScript-WebSockets-Internal.html#t:SocketMsg">SocketMsg</a></code> is a sum
 type of either 'SocketMsgText t', containing (strict) <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/text-1.2.0.3/html/Data-Text.html#t:Text">Text</a></code>, or
 'SocketMsgData d', containing a (lazy) <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/bytestring-0.10.6.0/html/Data-ByteString-Lazy.html#t:ByteString">ByteString</a></code>.</p><p>Will return 'Just msg' as soon as any message is received, or <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#v:Nothing">Nothing</a></code>
 if the <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> closes first.  Returns <code><a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Data-Maybe.html#v:Nothing">Nothing</a></code> immediately if the
 <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> is already closed.</p></div></div><h1 id="g:7">Connection mutex</h1><div class="top"><p class="src"><a name="v:withConnBlock" class="def">withConnBlock</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a</p><div class="doc"><p>Execute process with the connection mutex lock in effect.  Will wait
 until the lock is released before starting, if lock was already in
 place.</p><p>Will break almost every <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> function if you run one while this
 is in effect, because almost all of them require the lock to begin.</p></div></div><div class="top"><p class="src"><a name="v:withConnBlockMasked" class="def">withConnBlockMasked</a> :: <a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a> -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a -&gt; <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/System-IO.html#t:IO">IO</a> a</p><div class="doc"><p>Execute process with the connection mutex lock in effect, with
 asynchronos exceptions masked (See <a href="file:///home/justin/.ghcjs/x86_64-linux-0.1.0-7.8.3/ghcjs/doc/lib/base-4.7.0.2/html/Control-Exception.html">Control.Exception</a>).  Will wait
 until the lock is released before starting, if lock was already in
 place.</p><p>Will break almost every <code><a href="JavaScript-WebSockets-Internal.html#t:Connection">Connection</a></code> function if you run one while this
 is in effect, because almost all of them require the lock to begin.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.15.0.2</p></div></body></html>